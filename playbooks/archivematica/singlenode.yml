---
- hosts: "am-local"

  pre_tasks:

    - include_vars: "vars-singlenode-qa.yml"
      tags:
        - "always"
    - 
  roles:

    - role: "artefactual.elasticsearch"
      become: "yes"
      tags:
        - "elasticsearch"
      when: "archivematica_src_search_enabled|bool"

    - role: "artefactual.percona"
      become: "yes"
      tags:
        - "percona"

    - role: "artefactual.nginx"
      become: "yes"
      tags:
        - "nginx"

    - role: "artefactual.gearman"
      become: "yes"
      tags:
        - "gearman"

    - role: "artefactual.clamav"
      become: "yes"
      tags:
        - "clamav"

    - role: "artefactual.archivematica-src"
      become: "yes"
      tags:
        - "archivematica-src"

  tasks:
    - name: "Open firewall ports 80 and 8000 for AM and SS"
      command: "firewall-cmd --permanent --add-port {{ item }}/tcp"
      with_items:
        - "80"
        - "8000"
      become: "yes"
      tags: "firewalld"
      when: "ansible_os_family == 'RedHat'"
    - name: "Reload firewall"
      command: "firewall-cmd --reload"
      become: "yes"
      tags: "firewalld"
      when: "ansible_os_family == 'RedHat'"

